# 谈谈浏览器的事件循环

事件循环不是 JavaScript 引擎实现的，JavaScript 引擎只负责把一段 JavaScript 代码执行。事件循环是它所在的宿主环境实现的，类似下面的代码：

```js
function eventLoop() {
    var eventLoop = [];
    var event;
    while(true) {
        if (eventLoop.length > 0) {
            event = eventLoop.shift();

            try {
                event();
            } catch (e) {
                
            }
        }
    }
}
```

一定要清楚，setTimeout(..) 并没有把你的回调函数挂在事件循环队列中。它所做的是设定一个定时器。当定时器到时后，环境会把你的回调函数放在事件循环中，这样，在未来某个时刻的tick 会摘下并执行这个回调。

如果这时候事件循环中已经有 20 个项目了会怎样呢?你的回调就会等待。它得排在 其他项目后面——通常没有抢占式的方式支持直接将其排到队首。这也解释了为什么 setTimeout(..) 定时器的精度可能不高。大体说来，只能确保你的回调函数不会在指定的 时间间隔之前运行，但可能会在那个时刻运行，也可能在那之后运行，要根据事件队列的 状态而定。

JavaScript 是运行在单线程下的，也就是如果一个函数开始执行，它是原子性的，不会被其它要执行的代码所打断，是完整运行的。


### 相关面试题

- 对settimeout和对setinterval的理解（涉及代码题倒计时函数，eventloop的考点）计时是否准确？如何实现较为准确的计时？